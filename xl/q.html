<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Update Excel File</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.4/xlsx.full.min.js"></script>
</head>
<body>
    <h1>Update and Download Excel File</h1>
    <button id="update">Update Excel</button>

    <script>
        document.getElementById('update').addEventListener('click', async () => {
            try {
                // Fetch the existing Excel file
                const response = await fetch('your-file.xlsx'); // Replace with the actual file path
                const arrayBuffer = await response.arrayBuffer();

                // Read the workbook from the arrayBuffer
                const workbook = XLSX.read(arrayBuffer, { type: 'array' });

                // Access the first worksheet
                const sheetName = workbook.SheetNames[0];
                const worksheet = workbook.Sheets[sheetName];

                // New data to be added starting from row 14
                const newData = [
                    ["Name", "Age", "Email"],
                    ["John Doe", "30", "john@example.com"],
                    ["Jane Smith", "25", "jane@example.com"],
                    ["Mike Johnson", "35", "mike@example.com"]
                ];

                // Convert the new data to worksheet format starting from row 14
                XLSX.utils.sheet_add_aoa(worksheet, newData, { origin: { r: 13, c: 0 } });

                // Write the updated workbook to a binary string
                const wbout = XLSX.write(workbook, { bookType: 'xlsx', type: 'binary' });

                // Convert the binary string to an ArrayBuffer
                function s2ab(s) {
                    const buf = new ArrayBuffer(s.length);
                    const view = new Uint8Array(buf);
                    for (let i = 0; i < s.length; i++) {
                        view[i] = s.charCodeAt(i) & 0xFF;
                    }
                    return buf;
                }

                // Create a Blob from the ArrayBuffer and trigger the download
                const blob = new Blob([s2ab(wbout)], { type: "application/octet-stream" });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'updated-file.xlsx';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
            } catch (error) {
                console.error('Error updating the Excel file:', error);
            }
        });
    </script>
</body>
</html>
